import React, { useState } from 'react';
import { Book, ChevronDown, ChevronRight, Search, Info, Scale, FileText } from 'lucide-react';

// Define the article structure
interface Article {
  article_no: string;
  title: string;
  text: string;
}

interface Chapter {
  chapter: string;
  articles: Article[];
}

interface Part {
  part: string;
  chapters: Chapter[];
}

// GTPL RC 128 Law Part One in Arabic
const gtplRC128PartOne: Part = {
  part: "الباب الأول: أحكام عامة",
  chapters: [
    {
      chapter: "الفصل الأول: التعريفات",
      articles: [
        {
          article_no: "المادة 1",
          title: "التعريفات",
          text: "يقصد بالألفاظ والعبارات الآتية -أينما وردت في هذا النظام- المعاني المبينة أمام كل منها، ما لم يقتض السياق غير ذلك:\n\nالنظام: نظام المنافسات والمشتريات الحكومية.\n\nاللائحة: اللائحة التنفيذية للنظام.\n\nالوزير: وزير المالية.\n\nالوزارة: وزارة المالية.\n\nالهيئة: هيئة المحتوى المحلي والمشتريات الحكومية.\n\nجهة الشراء الموحد: الجهة المكلفة بالشراء الاستراتيجي الموحد، التي تحدد بقرار من مجلس الوزراء.\n\nالجهات الحكومية: الوزارات والأجهزة والمصالح والهيئات والمؤسسات العامة، وغيرها من الجهات ذات الشخصية المعنوية العامة المستقلة.\n\nرئيس الجهة الحكومية: الوزير أو الرئيس أو المحافظ أو المسؤول الأول في الجهة الحكومية.\n\nالبوابة: البوابة الإلكترونية الموحدة للمشتريات الحكومية الخاضعة لإشراف الوزارة."
        }
      ]
    },
    {
      chapter: "الفصل الثاني: أهداف النظام",
      articles: [
        {
          article_no: "المادة 2",
          title: "أهداف النظام",
          text: "يهدف النظام إلى الآتي:\n\n1. تنظيم الإجراءات ذات الصلة بالأعمال والمشتريات، ومنع استغلال النفوذ وتأثير المصالح الشخصية فيها؛ وذلك حماية للمال العام.\n\n2. تحقيق أفضل قيمة للمال العام عند التعاقد على الأعمال والمشتريات وتنفيذها بأسعار تنافسية عادلة.\n\n3. تعزيز النزاهة والمنافسة، وتحقيق المساواة، وتوفير معاملة عادلة للمتنافسين؛ تحقيقاً لمبدأ تكافؤ الفرص.\n\n4. ضمان الشفافية في جميع إجراءات الأعمال والمشتريات.\n\n5. تعزيز التنمية الاقتصادية."
        }
      ]
    },
    {
      chapter: "الفصل الثالث: المبادئ الأساسية",
      articles: [
        {
          article_no: "المادة 3",
          title: "ضوابط المتعاقد والمتنافس",
          text: "1. تتعامل الجهات الحكومية عند تنفيذ أعمالها وتأمين مشترياتها مع الأشخاص المرخص لهم بذلك، طبقاً للأنظمة والقواعد المتبعة.\n\n2. على الجهة الحكومية عند تعاملها مع أشخاص أجانب لتأمين مشتريات أو تنفيذ أعمال داخل المملكة التأكد من عدم توافر أكثر من شخص محلي مؤهل لتأمين المشتريات أو تنفيذ الأعمال المطلوبة. وتحدد اللائحة الشروط والضوابط اللازمة لتطبيق حكم هذه الفقرة."
        },
        {
          article_no: "المادة 4",
          title: "تساوي الفرص",
          text: "يعطى جميع الأشخاص الراغبين في التعامل مع الجهة الحكومية، ممن تتوافر فيهم الشروط التي تؤهلهم لهذا التعامل؛ فرصاً متساوية ويعاملون على قدم المساواة."
        },
        {
          article_no: "المادة 5",
          title: "معلومات المنافسة",
          text: "تُوفَر للمتنافسين معلومات واضحة وموحدة عن الأعمال والمشتريات المطلوبة، ويمكَنون من الحصول عليها في وقت محدد."
        },
        {
          article_no: "المادة 6",
          title: "مبادئ المنافسة العامة",
          text: "تخضع المنافسة العامة لمبادئ العلانية والشفافية وتكافؤ الفرص."
        },
        {
          article_no: "المادة 7",
          title: "قبول العروض",
          text: "لا يجوز قبول العروض والتعاقد بموجبها إلا طبقاً لأحكام النظام."
        },
        {
          article_no: "المادة 8",
          title: "ضوابط طرح المنافسات",
          text: "يكون طرح الأعمال والمشتريات والتعاقد في حدود الاحتياجات الفعلية للجهة الحكومية، وبأسعار عادلة لا تزيد عن الأسعار السائدة في السوق."
        },
        {
          article_no: "المادة 9",
          title: "الأولوية في التعامل",
          text: "تكون الأولوية في التعامل للمنشآت الصغيرة والمتوسطة المحلية وللمحتوى المحلي، وللشركات المدرجة في السوق المالية. وتوضح اللائحة المشار إليها في الفقرة (3) من المادة (السادسة والتسعين) من النظام آلية ذلك."
        }
      ]
    },
    {
      chapter: "الفصل الرابع: نطاق تطبيق النظام",
      articles: [
        {
          article_no: "المادة 10",
          title: "الجهات الخاضعة لأحكام النظام",
          text: "يطبق النظام على جميع الجهات الحكومية."
        },
        {
          article_no: "المادة 11",
          title: "الأعمال والمشتريات المنفذة خارج المملكة",
          text: "تخضع لأحكام النظام الأعمال والمشتريات التي تنفَذ خارج المملكة، ويجوز استثناؤها من بعض تلك الأحكام وفق ما توضحه اللائحة."
        }
      ]
    },
    {
      chapter: "الفصل الخامس: التخطيط المسبق",
      articles: [
        {
          article_no: "المادة 12",
          title: "نشر الجهة الحكومية لخطة أعمالها ومشترياتها",
          text: "1. على الجهة الحكومية التخطيط المسبق لأعمالها ومشترياتها والتنسيق مع الوزارة في توفير الاعتمادات المالية لها، وتلتزم في بداية كل سنة مالية بنشر خطة تتناسب مع ميزانيتها تتضمن المعلومات الرئيسة حول أعمالها ومشترياتها خلال هذه السنة، وذلك دون إخلال بما يقتضيه الأمن الوطني من سرية.\n\n2. لا يترتب على نشر الجهة الحكومية خطط أعمالها ومشترياتها أي التزام."
        }
      ]
    },
    {
      chapter: "الفصل السادس: التنظيم المؤسسي",
      articles: [
        {
          article_no: "المادة 13",
          title: "التزامات الوزارة",
          text: "1. تنفيذاً لأحكام النظام؛ تقوم الوزارة بالآتي:\nأ- إنشاء البوابة، والإشراف عليها، وتطويرها بشكل مستمر.\nب- وضع السياسات، وإصدار التوجيهات والتعليمات والأدلة الإرشادية، المتعلقة بتنفيذ أحكام النظام واللائحة.\nج- جمع المعلومات المتعلقة بأنشطة المنافسات، ونشرها في البوابة، ومتابعة تطبيق أحكام النظام، وذلك دون إخلال بأدوار الجهات الرقابية الأخرى.\nد- نشر القوائم الخاصة بالأشخاص المحظور التعامل معهم، من خلال البوابة.\n\n2. يعتمد الوزير نماذج وثائق المنافسات، ووثائق التأهيل المسبق، ونماذج للعقود، ونماذج تقييم أداء المتعاقدين، وأي وثيقة أخرى تتطلبها طبيعة الأعمال أو المشتريات."
        },
        {
          article_no: "المادة 14",
          title: "اختصاصات الجهة المختصة بالشراء الموحد",
          text: "دون إخلال باختصاص الهيئة العامة للصناعات العسكرية، وتنفيذاً لأحكام النظام؛ تختص الجهة المختصة بالشراء الموحد بما يلي:\n\n1. تحديد الأعمال والمشتريات التي تحتاج إليها أكثر من جهة حكومية، وتوحيد مواصفاتها الفنية، ومباشرة جميع إجراءات طرحها، وتلقّي العروض ودراستها واختيار أفضلها، وإبرام اتفاقيات إطارية في شأنها نيابةً عن الجهات الحكومية وفقاً لأحكام النظام.\n\n2. إعداد قوائم بالأعمال والمشتريات المبرم في شأنها اتفاقيات إطارية، وتمكين الجهات الحكومية من الاطلاع عليها وعلى ما تضمنته الاتفاقيات الإطارية من بنود من خلال البوابة.\n\n3. مراجعة ما ترفعه إليها الجهات الحكومية من دراسات جدوى وتكاليف تقديرية للمشتريات والأعمال التي تتولى طرحها، وما يتعلق بها من وثائق للمنافسة ووثائق للتأهيل المسبق -إن وجد- وإبداء الرأي في شأنها خلال مدة تحددها اللائحة.\n\n4. إعداد نماذج وثائق المنافسات ووثائق التأهيل المسبق، ونماذج للعقود، ونماذج تقييم أداء المتعاقدين، وأي وثيقة أخرى تتطلبها طبيعة الأعمال أو المشتريات؛ بما يتفق مع أحكام النظام واللائحة واللوائح المنصوص عليها في المادة (السادسة والتسعين) من النظام.\n\n5. إعداد البرامج التدريبية اللازمة لتطوير مؤهلات ومهارات القائمين على تطبيق أحكام النظام في الجهات الحكومية."
        },
        {
          article_no: "المادة 15",
          title: "قوائم الشراء الموحد، وواجبات طرح المشاريع",
          text: "1. لا يجوز للجهة الحكومية تأمين المشتريات أو تنفيذ الأعمال الواردة في القوائم التي تعدها الجهة المختصة بالشراء الموحد إلا من خلال الاتفاقيات الإطارية التي أبرمتها الجهة المختصة بالشراء الموحد.\n\n2. استثناء من حكم الفقرة (1) من هذه المادة، للجهة الحكومية -بعد موافقة الجهة المختصة بالشراء الموحد- تنفيذ الأعمال وتأمين المشتريات الواردة في القوائم وفقاً لأحكام النظام.\n\n3. على الجهة الحكومية قبل طرح مشاريعها أو أعمالها أو قبل إجراء التأهيل المسبق -إن وجد- عرض دراسة الجدوى والتكلفة التقديرية ووثائق المنافسة ووثائق التأهيل المسبق -إن وجدت- وما اتخذته من إجراءات، على الجهة المختصة بالشراء الموحد؛ لمراجعتها خلال المدة التي تحددها اللائحة، فإن لم ترد الجهة المختصة بالشراء الموحد خلال هذه المدة عدت موافقة، وعلى الجهة الحكومية الالتزام بما تطلبه الجهة المختصة بالشراء الموحد من تعديلات.\n\n4. استثناء من حكم الفقرة (3) من هذه المادة، للجهة الحكومية طرح مشاريعها أو أعمالها أو إجراء التأهيل المسبق -إن وجد- دون عرض دراسة الجدوى والتكلفة التقديرية ووثائق المنافسة ووثائق التأهيل المسبق-إن وجدت- وما اتخذته من إجراءات، على الجهة المختصة بالشراء الموحد؛ وذلك في الأعمال والمشتريات التي لا تزيد تكلفتها التقديرية على المبلغ الذي تحدده اللائحة أو التي تنطوي على حالة طارئة أو عاجلة، ويكتفى بإشعار الجهة المختصة بالشراء الموحد بما تم في شأنها."
        }
      ]
    },
    {
      chapter: "الفصل السابع: البوابة",
      articles: [
        {
          article_no: "المادة 16",
          title: "طرح إجراءات المنافسات والمشتريات الحكومية",
          text: "تطرح إجراءات المنافسات والمشتريات الحكومية من خلال البوابة -ما لم يتعذر ذلك لأسباب فنية أو لأسباب تتعلق بالأمن الوطني- وفقاً لما توضحه اللائحة."
        },
        {
          article_no: "المادة 17",
          title: "أحكام البوابة",
          text: "1. يجب أن يتوافر في البوابة أعلى درجات الخصوصية والسرية والأمان وشفافية المعلومات، مع ضمان سلامة الإجراءات.\n\n2. يجب أن تتيح البوابة للراغبين والمهتمين من ذوي الشأن الاطلاع على المعلومات والبيانات المتعلقة بالمنافسات التي تحددها اللائحة.\n\n3. يخصص في البوابة سجل لكل جهة حكومية يدون فيه جميع المعلومات والبيانات والإجراءات المتعلقة بما أبرمته من عقود وبما طرحته من مشاريع وأعمال وفقاً لما توضحه اللائحة.\n\n4. تتقاضى الوزارة مقابلاً مالياً عن الخدمات التي تقدمها البوابة، ويحدد مجلس الوزراء مقدار هذا المقابل، ويجوز تعديله بقرار من المجلس بناءً على اقتراح من الوزارة."
        }
      ]
    },
    {
      chapter: "الفصل الثامن: شروط التعامل وتأهيل المتنافسين",
      articles: [
        {
          article_no: "المادة 18",
          title: "الشروط الواجبة في المتعامل مع الجهة الحكومية",
          text: "يجب أن تتوافر في الأشخاص الذين تتعامل معهم الجهات الحكومية الشروط اللازمة لتنفيذ الأعمال وتأمين المشتريات وفقاً لما توضحه اللائحة."
        },
        {
          article_no: "المادة 19",
          title: "إجراء التأهيل المسبق أو اللاحق",
          text: "1. على الجهة الحكومية إجراء تأهيل مسبق أو لاحق في الأعمال والمشتريات وفقاً لما توضحه اللائحة.\n\n2. في حال إجراء تأهيل مسبق، تقتصر الدعوة للمشاركة في المنافسة على من اجتاز التأهيل المسبق فقط."
        },
        {
          article_no: "المادة 20",
          title: "ضوابط معايير التأهيل المسبق واللاحق",
          text: "يجب أن تكون معايير التأهيل المسبق أو اللاحق موضوعية وقابلة للقياس ومتعلقة بالقدرات الفنية والمالية والإدارية ومقدار الالتزامات التعاقدية للمتنافسين، وبما يتناسب مع طبيعة المشروع أو العمل وحجمه وقيمته."
        }
      ]
    },
    {
      chapter: "الفصل التاسع: وثائق المنافسة",
      articles: [
        {
          article_no: "المادة 21",
          title: "أحكام وثائق المنافسات",
          text: "1. يجب أن تتضمن وثائق المنافسات المعلومات والبيانات الخاصة بالأعمال والمشتريات المطروحة وفقاً لما تحدده اللائحة.\n\n2. يجب توفير نسخ إلكترونية لوثائق المنافسة في البوابة. وفي حال تعذر ذلك لأسباب فنية، فتوفر نسخ ورقية كافية.\n\n3. تحدد اللائحة معايير تحديد تكاليف وثائق المنافسة."
        }
      ]
    }
  ]
};

const GtplRC128ArticlesAr: React.FC = () => {
  const [expandedChapters, setExpandedChapters] = useState<string[]>([]);
  const [expandedArticles, setExpandedArticles] = useState<string[]>([]);
  const [searchTerm, setSearchTerm] = useState('');

  const toggleChapter = (chapter: string) => {
    setExpandedChapters(prev => 
      prev.includes(chapter) 
        ? prev.filter(c => c !== chapter) 
        : [...prev, chapter]
    );
  };

  const toggleArticle = (article: string) => {
    setExpandedArticles(prev => 
      prev.includes(article) 
        ? prev.filter(a => a !== article) 
        : [...prev, article]
    );
  };

  // Filter chapters and articles based on search term
  const filteredChapters = gtplRC128PartOne.chapters.map(chapter => {
    const filteredArticles = chapter.articles.filter(article => 
      article.title.includes(searchTerm) || 
      article.text.includes(searchTerm) ||
      article.article_no.includes(searchTerm)
    );
    
    return {
      ...chapter,
      articles: filteredArticles
    };
  }).filter(chapter => chapter.articles.length > 0 || chapter.chapter.includes(searchTerm));

  // Format text with proper line breaks
  const formatText = (text: string) => {
    return text.split('\n').map((paragraph, idx) => (
      <p key={idx} className="mb-4">{paragraph}</p>
    ));
  };

  return (
    <div className="p-6" dir="rtl">
      <div className="flex items-center justify-between mb-6">
        <h1 className="text-2xl font-bold text-gray-900">نظام المنافسات والمشتريات الحكومية</h1>
        <div className="flex items-center gap-2">
          <Book className="text-blue-600" size={24} />
          <span className="text-blue-600 font-medium">الباب الأول: أحكام عامة</span>
        </div>
      </div>

      <div className="mb-6">
        <div className="relative">
          <Search className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400" size={20} />
          <input
            type="text"
            placeholder="البحث في المواد..."
            className="pr-10 pl-4 py-2 w-full border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
          />
        </div>
      </div>

      <div className="bg-blue-50 p-4 rounded-lg mb-6">
        <div className="flex items-start gap-3">
          <Info size={20} className="text-blue-600 mt-1" />
          <div>
            <p className="font-medium text-blue-900">معلومات عن النظام</p>
            <p className="text-sm text-blue-700 mt-1">
              نظام المنافسات والمشتريات الحكومية الصادر بالمرسوم الملكي رقم م/128 وتاريخ 1440/11/13هـ
            </p>
          </div>
        </div>
      </div>

      <div className="space-y-6">
        {filteredChapters.map((chapter, chapterIndex) => (
          <div key={chapterIndex} className="bg-white rounded-lg border border-gray-200 overflow-hidden">
            <div 
              className="p-4 border-b border-gray-200 cursor-pointer hover:bg-gray-50"
              onClick={() => toggleChapter(chapter.chapter)}
            >
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-2">
                  <Scale size={20} className="text-blue-600" />
                  <h2 className="text-xl font-semibold text-gray-900">{chapter.chapter}</h2>
                </div>
                {expandedChapters.includes(chapter.chapter) ? (
                  <ChevronDown size={20} className="text-gray-400" />
                ) : (
                  <ChevronRight size={20} className="text-gray-400" />
                )}
              </div>
            </div>

            {expandedChapters.includes(chapter.chapter) && (
              <div className="p-4 space-y-4">
                {chapter.articles.map((article, articleIndex) => (
                  <div key={articleIndex} className="border border-gray-200 rounded-lg overflow-hidden">
                    <div 
                      className="p-4 border-b border-gray-200 cursor-pointer hover:bg-gray-50"
                      onClick={() => toggleArticle(`${chapter.chapter}-${article.article_no}`)}
                    >
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-2">
                          <FileText size={16} className="text-blue-600" />
                          <h3 className="font-medium text-gray-900">{article.article_no}: {article.title}</h3>
                        </div>
                        {expandedArticles.includes(`${chapter.chapter}-${article.article_no}`) ? (
                          <ChevronDown size={16} className="text-gray-400" />
                        ) : (
                          <ChevronRight size={16} className="text-gray-400" />
                        )}
                      </div>
                    </div>

                    {expandedArticles.includes(`${chapter.chapter}-${article.article_no}`) && (
                      <div className="p-4 bg-gray-50">
                        <div className="prose max-w-none text-gray-700">
                          {formatText(article.text)}
                        </div>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            )}
          </div>
        ))}

        {filteredChapters.length === 0 && (
          <div className="bg-white p-8 rounded-lg border border-gray-200 text-center">
            <p className="text-gray-500">لا توجد نتائج تطابق بحثك. يرجى تعديل مصطلحات البحث.</p>
          </div>
        )}
      </div>
    </div>
  );
};

export default GtplRC128ArticlesAr;